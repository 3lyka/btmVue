{"ast":null,"code":"import \"core-js/modules/es.array.at.js\";\nimport \"core-js/modules/es.string.at-alternative.js\";\n// import CalendarDay from \"@/components/views/trading-session/calendar/CalendarDay\";\nimport CalendarWeek from '@/components/views/trading-session/calendar/CalendarWeek';\nimport CalendarMonth from '@/components/views/trading-session/calendar/CalendarMonth';\nimport CalendarTab from '@/components/views/trading-session/calendar/CalendarTab';\nimport CalendarPagination from '@/components/views/trading-session/calendar/CalendarPagination';\nimport { mapState } from 'vuex';\nimport SubHeader from '../../../components-helpers/SubHeader.vue';\nimport { useInterval } from '@/composables/useInterval';\nimport { getCurrentInstance } from 'vue';\nexport default {\n  name: 'Calendar',\n  data: () => ({\n    activeTab: 'week',\n    monthKey: new Date().getMonth(),\n    year: new Date().getFullYear(),\n    dFirstMonth: '1',\n    daysWeek: ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'],\n    months: ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'],\n    date: new Date(),\n    numberWeek: 0\n  }),\n\n  setup() {\n    const {\n      ctx\n    } = getCurrentInstance(); // делаем запрос на обновление данных, раз в 1 минуту.\n\n    useInterval(() => ctx.getLots(), 60000);\n  },\n\n  mounted() {\n    this.getActiveTabFromLocalStorage(); // При переходе в лот с по клику с календаря возращаем на дату, с которой переходили.\n    // В случае при переходе по прямой ссылке, возращаемся в календарь на текущую дату.\n\n    const toCurrentDate = this.$route.params.toCurrentDate === 'true';\n\n    if (toCurrentDate) {\n      localStorage.removeItem('numberWeek');\n      localStorage.removeItem('monthKey');\n      localStorage.removeItem('year');\n      localStorage.removeItem('activeTab'); // возращаем на недельный вид.\n\n      this.activeTab = 'week'; // возращаем на недельный вид.\n    }\n\n    if (this.activeTab === 'week') {\n      this.setDefaultWeek();\n    } else {\n      this.setDefaultMonth();\n    }\n\n    this.getLots();\n    this.$store.subscribe(mutations => {\n      if (mutations.type === 'lot/lotFormSuccess') {\n        this.getLots();\n      }\n    });\n  },\n\n  watch: {\n    monthKey: {\n      handler() {\n        this.getLots();\n      }\n\n    }\n  },\n  computed: { ...mapState({\n      lots: state => state.lot.lots\n    }),\n    calendar: function () {\n      const days = [[]];\n      let week = 0;\n      let lastDay = new Date(this.year, this.monthKey + 1, 0).getDate();\n\n      for (let i = 1; i <= lastDay; i++) {\n        if (new Date(this.year, this.monthKey, i).getDay() === 1) {\n          week++;\n          days[week] = [];\n        }\n\n        const date = new Date(this.year, this.monthKey, i);\n        days[week].push({\n          number: i,\n          monthKey: this.monthKey,\n          date,\n          current: this.isToday(date)\n        });\n      }\n\n      if (days[0].length > 0) {\n        lastDay = new Date(this.year, this.monthKey, 0).getDate();\n        const firstMonth = 0;\n        let previousMonth = this.monthKey - 1;\n        let previousYear = this.year;\n\n        if (this.monthKey === firstMonth) {\n          previousMonth = 11;\n          previousYear = this.year - 1;\n        }\n\n        for (let i = days[0].length; i < 7; i++) {\n          const date = new Date(previousYear, previousMonth, lastDay);\n          days[0].unshift({\n            number: lastDay,\n            monthKey: previousMonth,\n            current: this.isToday(date),\n            date: date\n          });\n          lastDay--;\n        }\n      }\n\n      if (days[days.length - 1].length <= 6) {\n        let dayFirst = 1;\n        const lastMonth = 11;\n        let nextMonth = this.monthKey + 1;\n        let nextYear = this.year;\n\n        if (this.monthKey === lastMonth) {\n          nextMonth = 0;\n          nextYear = this.year + 1;\n        }\n\n        for (let i = days[days.length - 1].length; i < 7; i++) {\n          const date = new Date(nextYear, nextMonth, dayFirst);\n          days[days.length - 1].push({\n            number: dayFirst,\n            monthKey: nextMonth,\n            current: this.isToday(date),\n            date: date\n          });\n          dayFirst++;\n        }\n      }\n\n      if (days[0].length === 0) {\n        days.splice(0, 1);\n      }\n\n      if (this.$data.activeTab === 'week') {\n        return days;\n      } else {\n        return [].concat(...days);\n      }\n    }\n  },\n  methods: {\n    clickCloseLots() {\n      this.$refs?.calendarMonth?.clickCloseLots();\n    },\n\n    getLots() {\n      const dateStart = this.$data.activeTab === 'week' ? this.calendar.at(0).at(0).date : this.calendar.at(0).date,\n            dateEnd = this.$data.activeTab === 'week' ? this.calendar.at(-1).at(-1).date : this.calendar.at(-1).date;\n      this.$store.dispatch('lot/getListByMounts', {\n        dateStart: dateStart.toLocaleDateString('ru-RU'),\n        dateEnd: dateEnd.toLocaleDateString('ru-RU')\n      });\n    },\n\n    onTab(data) {\n      this.activeTab = data.code;\n      this.setActiveTabToLocalStorage();\n    },\n\n    setActiveTabToLocalStorage() {\n      //try catch\n      localStorage.setItem('activeTab', this.activeTab);\n    },\n\n    getActiveTabFromLocalStorage() {\n      this.activeTab = localStorage.getItem('activeTab') ? localStorage.getItem('activeTab') : 'week';\n    },\n\n    decrease() {\n      this.clickCloseLots();\n\n      if (this.activeTab === 'week') {\n        if (this.monthKey === 0 && this.numberWeek === 0) {\n          const day = this.calendar[0].find(({\n            date\n          }) => date.getDate() === 1);\n          const dayOffset = day.date.getDay() > 1 ? 2 : 1;\n          this.year--;\n          this.numberWeek = this.calendar.length - dayOffset;\n          this.monthKey = 11;\n        } else if (this.numberWeek === 0) {\n          const day = this.calendar[0].find(({\n            date\n          }) => date.getDate() === 1);\n          const dayOffset = day.date.getDay() !== 1 ? 2 : 1;\n          this.numberWeek = this.calendar.length - dayOffset;\n          this.monthKey--;\n        } else {\n          this.numberWeek--;\n        }\n      } else {\n        this.monthKey--;\n\n        if (this.monthKey < 0) {\n          this.monthKey = 12;\n          this.monthKey--;\n          this.year--;\n        }\n      }\n\n      this.setDataToLocalStorage();\n    },\n\n    setDefaultWeek() {\n      let defaultWeek = 0;\n      this.calendar.forEach(function (week, i) {\n        if (week.find(day => day.current === true)) {\n          defaultWeek = i;\n        }\n      });\n      this.numberWeek = localStorage.getItem('numberWeek') ? parseInt(localStorage.getItem('numberWeek')) : defaultWeek;\n      this.monthKey = localStorage.getItem('monthKey') ? parseInt(localStorage.getItem('monthKey')) : this.monthKey;\n      this.year = localStorage.getItem('year') ? parseInt(localStorage.getItem('year')) : this.year;\n    },\n\n    setDefaultMonth() {\n      this.monthKey = localStorage.getItem('monthKey') ? parseInt(localStorage.getItem('monthKey')) : this.monthKey;\n    },\n\n    increase() {\n      this.clickCloseLots();\n\n      if (this.activeTab === 'week') {\n        if (this.numberWeek < this.calendar.length - 1) {\n          this.numberWeek++;\n        } else {\n          const day = this.calendar[this.calendar.length - 1].find(({\n            date\n          }) => date.getDate() === 1);\n          this.numberWeek = day ? 1 : 0;\n          this.monthKey++;\n          const lastMonth = 11;\n\n          if (this.monthKey > lastMonth) {\n            this.monthKey = 0;\n            this.year++;\n          }\n        }\n      } else {\n        this.monthKey++;\n\n        if (this.monthKey > 11) {\n          this.monthKey = -1;\n          this.monthKey++;\n          this.year++;\n        }\n      }\n\n      this.setDataToLocalStorage();\n    },\n\n    isToday(date) {\n      const today = new Date();\n      return date.getDate() === today.getDate() && date.getFullYear() === today.getFullYear() && date.getMonth() === today.getMonth();\n    },\n\n    setDataToLocalStorage() {\n      localStorage.setItem('monthKey', this.monthKey);\n      localStorage.setItem('numberWeek', this.numberWeek);\n      localStorage.setItem('year', this.year);\n    }\n\n  },\n  components: {\n    CalendarTab,\n    CalendarPagination,\n    CalendarMonth,\n    CalendarWeek,\n    SubHeader\n  }\n};","map":{"version":3,"mappings":"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","names":["CalendarWeek","CalendarMonth","CalendarTab","CalendarPagination","mapState","SubHeader","useInterval","getCurrentInstance","name","data","activeTab","monthKey","Date","getMonth","year","getFullYear","dFirstMonth","daysWeek","months","date","numberWeek","setup","ctx","getLots","mounted","getActiveTabFromLocalStorage","toCurrentDate","$route","params","localStorage","removeItem","setDefaultWeek","setDefaultMonth","$store","subscribe","mutations","type","watch","handler","computed","lots","state","lot","calendar","days","week","lastDay","getDate","i","getDay","push","number","current","isToday","length","firstMonth","previousMonth","previousYear","unshift","dayFirst","lastMonth","nextMonth","nextYear","splice","$data","concat","methods","clickCloseLots","$refs","calendarMonth","dateStart","at","dateEnd","dispatch","toLocaleDateString","onTab","code","setActiveTabToLocalStorage","setItem","getItem","decrease","day","find","dayOffset","setDataToLocalStorage","defaultWeek","forEach","parseInt","increase","today","components"],"sourceRoot":"","sources":["C:\\openserver\\domains\\U190001472_BitumMap_Vue\\src\\components\\views\\trading-session\\calendar\\Calendar.vue"],"sourcesContent":["<template>\r\n  <div class=\"calendar\">\r\n    <ElAffix :z-index=\"1\" :offset=\"60\">\r\n      <div class=\"calendar__title\">\r\n        <div class=\"calendar__title-left\">\r\n          <CalendarPagination\r\n            @clickLast=\"decrease\"\r\n            @clickNext=\"increase\"\r\n            :activeTab=\"activeTab\"\r\n            :monthKey=\"monthKey\"\r\n            :year=\"year\"\r\n            :months=\"months\"\r\n            :calendar=\"calendar\"\r\n            :numberWeek=\"numberWeek\"\r\n          />\r\n        </div>\r\n        <div class=\"calendar__title-right\">\r\n          <SubHeader class=\"calendar__title-subheader\" />\r\n          <CalendarTab :onTab=\"onTab\" :activeTab=\"activeTab\" />\r\n        </div>\r\n      </div>\r\n    </ElAffix>\r\n    <CalendarWeek\r\n      v-if=\"activeTab === 'week'\"\r\n      :lots=\"lots\"\r\n      :monthKey=\"monthKey\"\r\n      :year=\"year\"\r\n      :daysWeek=\"daysWeek\"\r\n      :months=\"months\"\r\n      :date=\"date\"\r\n      :calendar=\"calendar\"\r\n      :numberWeek=\"numberWeek\"\r\n    />\r\n    <CalendarMonth\r\n      v-else-if=\"activeTab === 'month'\"\r\n      ref=\"calendarMonth\"\r\n      :lots=\"lots\"\r\n      :monthKey=\"monthKey\"\r\n      :year=\"year\"\r\n      :daysWeek=\"daysWeek\"\r\n      :months=\"months\"\r\n      :date=\"date\"\r\n      :calendar=\"calendar\"\r\n    />\r\n    <!-- <CalendarDay v-else-if=\"activeTab === 'day'\" /> -->\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n// import CalendarDay from \"@/components/views/trading-session/calendar/CalendarDay\";\r\nimport CalendarWeek from '@/components/views/trading-session/calendar/CalendarWeek';\r\nimport CalendarMonth from '@/components/views/trading-session/calendar/CalendarMonth';\r\nimport CalendarTab from '@/components/views/trading-session/calendar/CalendarTab';\r\nimport CalendarPagination from '@/components/views/trading-session/calendar/CalendarPagination';\r\nimport { mapState } from 'vuex';\r\nimport SubHeader from '../../../components-helpers/SubHeader.vue';\r\nimport { useInterval } from '@/composables/useInterval';\r\nimport { getCurrentInstance } from 'vue';\r\n\r\nexport default {\r\n  name: 'Calendar',\r\n\r\n  data: () => ({\r\n    activeTab: 'week',\r\n    monthKey: new Date().getMonth(),\r\n    year: new Date().getFullYear(),\r\n    dFirstMonth: '1',\r\n    daysWeek: ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'],\r\n    months: [\r\n      'Январь',\r\n      'Февраль',\r\n      'Март',\r\n      'Апрель',\r\n      'Май',\r\n      'Июнь',\r\n      'Июль',\r\n      'Август',\r\n      'Сентябрь',\r\n      'Октябрь',\r\n      'Ноябрь',\r\n      'Декабрь',\r\n    ],\r\n    date: new Date(),\r\n    numberWeek: 0,\r\n  }),\r\n\r\n  setup() {\r\n    const { ctx } = getCurrentInstance();\r\n\r\n    // делаем запрос на обновление данных, раз в 1 минуту.\r\n    useInterval(() => ctx.getLots(), 60000);\r\n  },\r\n  mounted() {\r\n    this.getActiveTabFromLocalStorage();\r\n\r\n    // При переходе в лот с по клику с календаря возращаем на дату, с которой переходили.\r\n    // В случае при переходе по прямой ссылке, возращаемся в календарь на текущую дату.\r\n    const toCurrentDate = this.$route.params.toCurrentDate === 'true';\r\n    if (toCurrentDate) {\r\n      localStorage.removeItem('numberWeek');\r\n      localStorage.removeItem('monthKey');\r\n      localStorage.removeItem('year');\r\n\r\n      localStorage.removeItem('activeTab'); // возращаем на недельный вид.\r\n      this.activeTab = 'week'; // возращаем на недельный вид.\r\n    }\r\n\r\n    if (this.activeTab === 'week') {\r\n      this.setDefaultWeek();\r\n    } else {\r\n      this.setDefaultMonth();\r\n    }\r\n\r\n    this.getLots();\r\n\r\n    this.$store.subscribe((mutations) => {\r\n      if (mutations.type === 'lot/lotFormSuccess') {\r\n        this.getLots();\r\n      }\r\n    });\r\n  },\r\n  watch: {\r\n    monthKey: {\r\n      handler() {\r\n        this.getLots();\r\n      },\r\n    },\r\n  },\r\n  computed: {\r\n    ...mapState({\r\n      lots: (state) => state.lot.lots,\r\n    }),\r\n    calendar: function () {\r\n      const days = [[]];\r\n      let week = 0;\r\n      let lastDay = new Date(this.year, this.monthKey + 1, 0).getDate();\r\n\r\n      for (let i = 1; i <= lastDay; i++) {\r\n        if (new Date(this.year, this.monthKey, i).getDay() === 1) {\r\n          week++;\r\n          days[week] = [];\r\n        }\r\n\r\n        const date = new Date(this.year, this.monthKey, i);\r\n\r\n        days[week].push({\r\n          number: i,\r\n          monthKey: this.monthKey,\r\n          date,\r\n          current: this.isToday(date),\r\n        });\r\n      }\r\n\r\n      if (days[0].length > 0) {\r\n        lastDay = new Date(this.year, this.monthKey, 0).getDate();\r\n        const firstMonth = 0;\r\n        let previousMonth = this.monthKey - 1;\r\n        let previousYear = this.year;\r\n        if (this.monthKey === firstMonth) {\r\n          previousMonth = 11;\r\n          previousYear = this.year - 1;\r\n        }\r\n        for (let i = days[0].length; i < 7; i++) {\r\n          const date = new Date(previousYear, previousMonth, lastDay);\r\n          days[0].unshift({\r\n            number: lastDay,\r\n            monthKey: previousMonth,\r\n            current: this.isToday(date),\r\n            date: date,\r\n          });\r\n          lastDay--;\r\n        }\r\n      }\r\n\r\n      if (days[days.length - 1].length <= 6) {\r\n        let dayFirst = 1;\r\n        const lastMonth = 11;\r\n        let nextMonth = this.monthKey + 1;\r\n        let nextYear = this.year;\r\n\r\n        if (this.monthKey === lastMonth) {\r\n          nextMonth = 0;\r\n          nextYear = this.year + 1;\r\n        }\r\n\r\n        for (let i = days[days.length - 1].length; i < 7; i++) {\r\n          const date = new Date(nextYear, nextMonth, dayFirst);\r\n          days[days.length - 1].push({\r\n            number: dayFirst,\r\n            monthKey: nextMonth,\r\n            current: this.isToday(date),\r\n            date: date,\r\n          });\r\n          dayFirst++;\r\n        }\r\n      }\r\n\r\n      if (days[0].length === 0) {\r\n        days.splice(0, 1);\r\n      }\r\n\r\n      if (this.$data.activeTab === 'week') {\r\n        return days;\r\n      } else {\r\n        return [].concat(...days);\r\n      }\r\n    },\r\n  },\r\n  methods: {\r\n    clickCloseLots() {\r\n      this.$refs?.calendarMonth?.clickCloseLots();\r\n    },\r\n\r\n    getLots() {\r\n      const dateStart =\r\n          this.$data.activeTab === 'week'\r\n            ? this.calendar.at(0).at(0).date\r\n            : this.calendar.at(0).date,\r\n        dateEnd =\r\n          this.$data.activeTab === 'week'\r\n            ? this.calendar.at(-1).at(-1).date\r\n            : this.calendar.at(-1).date;\r\n\r\n      this.$store.dispatch('lot/getListByMounts', {\r\n        dateStart: dateStart.toLocaleDateString('ru-RU'),\r\n        dateEnd: dateEnd.toLocaleDateString('ru-RU'),\r\n      });\r\n    },\r\n\r\n    onTab(data) {\r\n      this.activeTab = data.code;\r\n      this.setActiveTabToLocalStorage();\r\n    },\r\n    setActiveTabToLocalStorage() {\r\n      //try catch\r\n      localStorage.setItem('activeTab', this.activeTab);\r\n    },\r\n    getActiveTabFromLocalStorage() {\r\n      this.activeTab = localStorage.getItem('activeTab')\r\n        ? localStorage.getItem('activeTab')\r\n        : 'week';\r\n    },\r\n    decrease() {\r\n      this.clickCloseLots();\r\n\r\n      if (this.activeTab === 'week') {\r\n        if (this.monthKey === 0 && this.numberWeek === 0) {\r\n          const day = this.calendar[0].find(({ date }) => date.getDate() === 1);\r\n          const dayOffset = day.date.getDay() > 1 ? 2 : 1;\r\n          this.year--;\r\n          this.numberWeek = this.calendar.length - dayOffset;\r\n          this.monthKey = 11;\r\n        } else if (this.numberWeek === 0) {\r\n          const day = this.calendar[0].find(({ date }) => date.getDate() === 1);\r\n          const dayOffset = day.date.getDay() !== 1 ? 2 : 1;\r\n          this.numberWeek = this.calendar.length - dayOffset;\r\n          this.monthKey--;\r\n        } else {\r\n          this.numberWeek--;\r\n        }\r\n      } else {\r\n        this.monthKey--;\r\n        if (this.monthKey < 0) {\r\n          this.monthKey = 12;\r\n          this.monthKey--;\r\n          this.year--;\r\n        }\r\n      }\r\n      this.setDataToLocalStorage();\r\n    },\r\n    setDefaultWeek() {\r\n      let defaultWeek = 0;\r\n\r\n      this.calendar.forEach(function (week, i) {\r\n        if (week.find((day) => day.current === true)) {\r\n          defaultWeek = i;\r\n        }\r\n      });\r\n\r\n      this.numberWeek = localStorage.getItem('numberWeek')\r\n        ? parseInt(localStorage.getItem('numberWeek'))\r\n        : defaultWeek;\r\n      this.monthKey = localStorage.getItem('monthKey')\r\n        ? parseInt(localStorage.getItem('monthKey'))\r\n        : this.monthKey;\r\n      this.year = localStorage.getItem('year')\r\n        ? parseInt(localStorage.getItem('year'))\r\n        : this.year;\r\n    },\r\n\r\n    setDefaultMonth() {\r\n      this.monthKey = localStorage.getItem('monthKey')\r\n        ? parseInt(localStorage.getItem('monthKey'))\r\n        : this.monthKey;\r\n    },\r\n    increase() {\r\n      this.clickCloseLots();\r\n\r\n      if (this.activeTab === 'week') {\r\n        if (this.numberWeek < this.calendar.length - 1) {\r\n          this.numberWeek++;\r\n        } else {\r\n          const day = this.calendar[this.calendar.length - 1].find(\r\n            ({ date }) => date.getDate() === 1\r\n          );\r\n          this.numberWeek = day ? 1 : 0;\r\n          this.monthKey++;\r\n          const lastMonth = 11;\r\n          if (this.monthKey > lastMonth) {\r\n            this.monthKey = 0;\r\n            this.year++;\r\n          }\r\n        }\r\n      } else {\r\n        this.monthKey++;\r\n        if (this.monthKey > 11) {\r\n          this.monthKey = -1;\r\n          this.monthKey++;\r\n          this.year++;\r\n        }\r\n      }\r\n      this.setDataToLocalStorage();\r\n    },\r\n    isToday(date) {\r\n      const today = new Date();\r\n\r\n      return (\r\n        date.getDate() === today.getDate() &&\r\n        date.getFullYear() === today.getFullYear() &&\r\n        date.getMonth() === today.getMonth()\r\n      );\r\n    },\r\n    setDataToLocalStorage() {\r\n      localStorage.setItem('monthKey', this.monthKey);\r\n      localStorage.setItem('numberWeek', this.numberWeek);\r\n      localStorage.setItem('year', this.year);\r\n    },\r\n  },\r\n  components: {\r\n    CalendarTab,\r\n    CalendarPagination,\r\n    CalendarMonth,\r\n    CalendarWeek,\r\n    SubHeader,\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped></style>\r\n"]},"metadata":{},"sourceType":"module"}